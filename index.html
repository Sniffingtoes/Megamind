<script>
// Tech-tree connections
const nodes = document.querySelectorAll('.node');
const canvasTree = document.getElementById('connections');
const ctxTree = canvasTree.getContext('2d');

function animateTechTree(){
  canvasTree.width = canvasTree.offsetWidth;
  canvasTree.height = canvasTree.offsetHeight;
  ctxTree.clearRect(0,0,canvasTree.width,canvasTree.height);

  const centerNode = [...nodes].find(n => n.dataset.name==='Megamind');
  const cx = centerNode.offsetLeft + centerNode.offsetWidth/2;
  const cy = centerNode.offsetTop + centerNode.offsetHeight/2;

  // Fade-in nodes
  nodes.forEach((n,i)=> setTimeout(()=>{ n.style.opacity=1; n.style.transform='scale(1)'; }, i*200));

  // Define lines from center to others
  const lines = [...nodes].filter(n => n.dataset.name!=='Megamind').map(n => {
    const x = n.offsetLeft + n.offsetWidth/2;
    const y = n.offsetTop + n.offsetHeight/2;
    return {x1:cx, y1:cy, x2:x, y2:y, progress:0};
  });

  function animateLines(){
    ctxTree.clearRect(0,0,canvasTree.width,canvasTree.height);

    lines.forEach(line => {
      // Increment line progress
      line.progress += 0.02;
      if(line.progress>1) line.progress=1;

      // Draw background line
      ctxTree.strokeStyle='rgba(0,255,255,0.2)';
      ctxTree.lineWidth=2;
      ctxTree.beginPath();
      ctxTree.moveTo(line.x1,line.y1);
      ctxTree.lineTo(line.x2,line.y2);
      ctxTree.stroke();

      // Draw moving pulse
      const px = line.x1 + (line.x2-line.x1)*line.progress;
      const py = line.y1 + (line.y2-line.y1)*line.progress + Math.sin(Date.now()/200)*5;
      ctxTree.strokeStyle='rgba(0,255,255,0.8)';
      ctxTree.beginPath();
      ctxTree.moveTo(line.x1,line.y1);
      ctxTree.lineTo(px,py);
      ctxTree.stroke();

      // Draw glowing dot
      ctxTree.fillStyle='rgba(0,255,255,1)';
      ctxTree.beginPath();
      ctxTree.arc(px,py,4,0,Math.PI*2);
      ctxTree.fill();
    });

    requestAnimationFrame(animateLines);
  }

  animateLines();
}

window.addEventListener('load', animateTechTree);
window.addEventListener('resize', animateTechTree);
</script>
